<!DOCTYPE html>
<html style="width:100vw; height:100vh;">
<head>
    <title>This place feels... *groovy*</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="fav1.ico">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0">

</head>
<body style="width:100vw; height:100vh; margin:0; font-family:'Roboto Mono', monospace;">

    <div id="main-screen" style="display:flex; flex-direction:row;">
        <div id="left-section" style="width:auto; height:100vh; display:inline-block;">

            <div id="alert-message-board" style="display:fixed; position:absolute; z-index:100000; width:100%;">
            </div>

            <div id="video-container" style="max-width:75vw; max-height:90vh; position:relative;">
                <img src="test-img.jpg" alt="camera not connected" style="max-width:75vw; max-height:90vh;"/>
                <div id="camera-select-bar" style="position:absolute; bottom:2px; left:2px; display:flex; justify-content:center; width:30%; height:auto; color:white; font-family:'Roboto Mono', monospace;">
                    <button id="visual-button" class="tab-select" style="color:white; text-transform:capitalize; border:2px solid white; background-color:rgba(0,0,0,0.5); width:50%; font-size:2.3vh; font-family:'Roboto Mono', monospace; padding: 1vh;">
                    visual
                    </button>
                    <button id="thermal-button" class="tab-select" style="color:white; text-transform:capitalize; border:2px solid white; background-color:rgba(0,0,0,0.5); width:50%; font-size:2.3vh; font-family:'Roboto Mono', monospace; padding: 1vh;">
                    thermal
                    </button>
                </div>    
            </div>
            <div id="status-area-container" style="display:flex; width:100%; height:10vh">
                <div id="status-area" style="display:flex; justify-content:space-around; align-items:center; width:100%; height:10vh; padding-left:1em; padding-right:1em; background-color:black; color:white;">
                </div>
            </div>

            
        </div>
        <div id="right-section" style="width:100%; padding-left:1em; padding-right:1em; height:100vh; display:flex; flex-direction:column; justify-content: space-between;">
            <div id="target-F-info">
                <h3 style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center; width:100%; text-align:center; color:rgb(42,116,145); border:2px solid rgb(42,116,145);"><span>Target F</span><span>&#128393;</span></h3>
                <table style="margin-bottom:0.75em;">
                    <tr><td style="text-align:right;"><span style="font-weight:bold; color:rgb(42,116,145);">Set: </span></span></td><td><span id="target-F-set-temp">32</span>&#8451;</td></tr>
                    <tr><td style="text-align:right;"><span style="font-weight:bold; color:rgb(42,116,145);">Temp: </span></td><td><span id="target-F-current-temp">28</span>&#8451;</td></tr>
                    <tr><td style="text-align:right;"><span style="font-weight:bold; color:rgb(42,116,145);">(x,y): </span></td><td><span id="target-F-x-pos">48</span>mm,<span id="target-F-y-pos">121</span>mm</td></tr>
                    <tr><td style="text-align:right;"><span style="font-weight:bold; color:rgb(42,116,145);">Moved: </span></td><td><span id="target-F-distance-moved">24</span>mm</td></tr>
                </table>
                <!-- <div style="display:flex; flex-direction:row; justify-content:center;">
                    <button>SELECT TARGET A</button>
                </div> -->
            </div>
            <div id="target-M-info">
                <h3 style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center; width:100%; text-align:center; color:rgb(104,0,52); border:2px solid rgb(104,0,52);"><span>Target M</span><span>&#128393;</span></h3>
                <table style="margin-bottom:0.75em;">
                    <tr><td style="text-align:right;"><span style="font-weight:bold; color:rgb(104,0,52);">Set: </span></span></td><td><span id="target-M-set-temp">32</span>&#8451;</td></tr>
                    <tr><td style="text-align:right;"><span style="font-weight:bold; color:rgb(104,0,52);">Temp: </span></td><td><span id="target-M-current-temp">28</span>&#8451;</td></tr>
                    <tr><td style="text-align:right;"><span style="font-weight:bold; color:rgb(104,0,52);">(x,y): </span></td><td><span id="target-M-x-pos">48</span>mm,<span id="target-M-y-pos">121</span>mm</td></tr>
                    <tr><td style="text-align:right;"><span style="font-weight:bold; color:rgb(104,0,52);">Moved: </span></td><td><span id="target-M-distance-moved">24</span>mm</td></tr>
                </table>
                <!-- <div style="display:flex; flex-direction:row; justify-content:center;">
                    <button>SELECT TARGET B</button>
                </div> -->
            </div>
            <div id="indicators-div" style="margin-bottom:1em; font-size:1.8vw;">
                <div id="pc-connection-indicator" class="indicator-light" style="display:flex; flex-direction:row;"><div style="width:0.75em; height:0.75em; border:2px solid black; margin:2px; margin-right:.75em"></div><div>PC Connected</div></div>
                <div id="enrem-indicator" class="indicator-light" style="display:flex; flex-direction:row;"><div style="width:0.75em; height:0.75em; border:2px solid black; margin:2px; margin-right:.75em"></div><div>Remote Enabled</div></div>
                <div id="calibrated-indicator" class="indicator-light" style="display:flex; flex-direction:row;"><div style="width:0.75em; height:0.75em; border:2px solid black; margin:2px; margin-right:.75em"></div><div>System Calibrated</div></div>
            </div>
            <div id="primary-action-button-container" style="width:100%; height:10vh; display:flex; flex-direction:column; justify-content:center;">
                <button disabled id="primary-action-button" style="height:9vh; font-family:'Roboto Mono', monospace;"><span style="font-weight:bold; font-size:125%; height:10vh;">START TRIAL</span></button>
            </div>
        </div>
    </div>

    <div id="calibrate-screen">
        
    </div>

    <div id="trial-screen">
        
    </div>

    <div id="load-popup">
        
    </div>

    <div id="save-popup">
        
    </div>

    <script type="text/javascript">

// FRONT-END FUNCTIONS

        function markViewAsVisual(set){
            var visualButton = document.getElementById('visual-button');
            if(set) {
                visualButton.style.color = "black";
                visualButton.style.backgroundColor = "white";
                visualButton.style.fontWeight = "bold";
                markViewAsThermal(false);
            }
            else {
                visualButton.style.color = "white";
                visualButton.style.backgroundColor = "rgba(0,0,0,0.5)";
                visualButton.style.fontWeight = "normal";
            }
        }
        function markViewAsThermal(set){
            var thermalButton = document.getElementById('thermal-button');
            if(set) {
                thermalButton.style.color = "black";
                thermalButton.style.backgroundColor = "white";
                thermalButton.style.fontWeight = "bold";
                markViewAsVisual(false);
            }
            else {
                thermalButton.style.color = "white";
                thermalButton.style.backgroundColor = "rgba(0,0,0,0.5)";
                thermalButton.style.fontWeight = "normal";
            }
        }
        function clearContinuousAlerts() {
            alerts = document.getElementById('alert-message-board');
            while (alerts.firstChild) {
               alerts.removeChild(alerts.firstChild);
            }
        }
        function displayContinuousAlert(message, color) {
            clearContinuousAlerts();
            var messageDiv = document.createElement('div');
            messageDiv.appendChild(document.createTextNode(message));
            messageDiv.style = "position:absolute; top: 5vh; color:"+color+"; font-weight:bold; text-transform:capitalize; margin-left: 1em;";
            messageDiv.setAttribute("id", "alert"+document.getElementsByClassName('continuous-alert').length);
            messageDiv.setAttribute("class", "continuous-alert");
            messageDiv.appendChild(document.createElement('br'));
            document.getElementById('alert-message-board').appendChild(messageDiv);

        }
        function displayLaserArmedWarning(){
            displayContinuousAlert('WARNING: laser armed!', 'yellow');
        }
        function displayLaserActiveWarning(){
            displayContinuousAlert('DANGER: laser active!', 'red');
        }
        function clearStatusArea(){
            statusArea = document.getElementById('status-area');
            while (statusArea.firstChild) {
               statusArea.removeChild(statusArea.firstChild);
            }
        }
        function getSpan(id, contentNode) {
            var newSpan = document.createElement('span');
            newSpan.setAttribute('id', id);
            newSpan.appendChild(contentNode);
            return newSpan;
        }
        function getTimeStamp(seconds) {
            return "" + Math.floor(seconds / 60) + ":" + ("0" + seconds % 60).slice(-2); 
        }
        function showDiscoProgress(secElapsed, secTotal){
            clearStatusArea();

            var statusMessage = document.createTextNode("Disco in progress... ");

            var progressBar = document.createElement('progress');
            progressBar.setAttribute('id', 'progress-bar');
            progressBar.setAttribute('value', secElapsed);
            progressBar.setAttribute('max', secTotal);

            var elapsedTimeDisplay = document.createTextNode(getTimeStamp(secElapsed));
            var statusSpacer = document.createTextNode(" / ");
            var trialLengthDisplay = document.createTextNode(getTimeStamp(secTotal));

            statusArea.appendChild(getSpan('progress-bar-span', statusMessage));
            statusArea.appendChild(getSpan('progress-bar-span', progressBar));
            statusArea.appendChild(getSpan('elapsed-time-display', elapsedTimeDisplay));
            statusArea.appendChild(getSpan('elapsed-time-display', statusSpacer));
            statusArea.appendChild(getSpan('elapsed-time-display', trialLengthDisplay));
        }

        // Pass in a dict to update data display for a particular target.
        // If useLonghand is true, use the DOM IDs for keys, else use the JS shorthand:
        function updateTargetDataDisplay(dataObj, useLonghand){
            var dataIDs = {
                "setF":"target-F-set-temp",
                "tempF":"target-F-current-temp",
                "xF":"target-F-x-pos",
                "yF":"target-F-y-pos",
                "movedF":"target-F-distance-moved",
                "setM":"target-M-set-temp",
                "tempM":"target-M-current-temp",
                "xM":"target-M-x-pos",
                "yM":"target-M-y-pos",
                "movedM":"target-M-distance-moved",
            };
            for (var key in dataObj){
                let targetId = useLonghand ? key : dataIDs[key];
                let val = dataObj[key];
                if(val) document.getElementById(targetId).innerHTML = val;
            };
        }
        function setStatusAreaColor(color){
            document.getElementById('status-area').style.backgroundColor=color;
        }
        // isOn = true for green, isOn = false for red, isOn = undefined for transparent (reset)
        function setIndicator(index, isOn){ 
            if(isOn == undefined) {
                var indicator=document.getElementsByClassName('indicator-light')[index].firstChild.style.backgroundColor = "transparent";    
                return;
            }
            var indicator=document.getElementsByClassName('indicator-light')[index].firstChild.style.backgroundColor = isOn ? "green" : "red";
        }
        function enablePrimaryActionButton(){
            document.getElementById("primary-action-button").removeAttribute("disabled");
        }
        function disablePrimaryActionButton(){
            document.getElementById("primary-action-button").setAttribute("disabled", "disabled");
        }



// HARDWARE INTERFACE FUNCTIONS
    
        function laserIsArmed() {
            // Implement with feedback from DISARM signal
        }

//********************************************************************
// BACKEND INTERFACE FUNCTIONS ********* IMPLEMENT THIS!!!************

        function setVisualView(){
            markViewAsVisual(true);
            // Implement so that cam image updates from visual

            // REMOVE THIS! JUST TO SHOW FUNCTIONALITY DURING DEV!
            clearContinuousAlerts();
            clearStatusArea();
            setIndicator(0);
            setIndicator(1);
        }
        document.getElementById('visual-button').addEventListener('click', setVisualView, true);
        setVisualView(); // start page with visual view on

        function setThermalView(){
            markViewAsThermal(true);
            // Implement so that cam image updates from thermal
            clearContinuousAlerts();

            // REMOVE THIS! JUST TO SHOW FUNCTIONALITY DURING DEV!
            displayLaserArmedWarning();
            showDiscoProgress(68, 180);
            setIndicator(0,false);
            setIndicator(1,true);
        }
        document.getElementById('thermal-button').addEventListener('click', setThermalView, true);

    </script>

</body>
</html>